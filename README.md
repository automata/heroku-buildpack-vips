heroku-buildpack-vips
=====================

Heroku buildpack with [libvips](https://github.com/jcupitt/libvips) installed.

Useful to support [sharp](https://github.com/lovell/sharp) 0.17 and
[noflo-sharp](https://github.com/noflo/noflo-sharp) 0.2.5 on Heroku.

Current vips version is 8.4.5 with webp 0.6.0 and giflib 5.1.4. Other
dependencies are obtained from default Travis/Heroku Ubuntu Trusty
environments.

## Supported operations/filetypes

    use fftw3 for FFT:                        no
    Magick package:                           MagickCore
    file import with libMagick:               no
    accelerate loops with orc:                no
    ICC profile support with lcms:            yes
    file import with OpenEXR:                 yes
    file import with OpenSlide:               no
    file import with matio:                   no
    PDF import with poppler-glib:             no
    SVG import with librsvg-2.0:              yes
    zlib:                                     yes
    file import with cfitsio:                 yes
    file import/export with libwebp:          yes
    text rendering with pangoft2:             no
    file import/export with libpng:           yes
    file import/export with libtiff:          yes
    file import/export with giflib:           yes
    file import/export with libjpeg:          yes
    image pyramid export:                     no
    use libexif to load/save JPEG metadata:   yes

## About libtiff and other dependencies

We removed `libtiff.*` from the vips bundle because it's version (5.0) was
conflicting with opencv (4.0). Removing `libtiff.*` made it use the user
default's libtiff (5.0). Symbol names on the original vips bundle
`libtiff.so` are wrong, they have versions appended, which causes the conflict.

Other dependencies like glib, orc, lcms2, libxml and etc are solved by using
system default for Travis/Heroku Ubuntu Trusty env.

The most recent bundles are hosted by The Grid:
- Travis:
[https://caliper-tests.s3.amazonaws.com/bundles/libvips-0.5.0-travis.tgz](https://caliper-tests.s3.amazonaws.com/bundles/libvips-0.5.0-travis.tgz)
- Heroku: 
[https://caliper-tests.s3.amazonaws.com/bundles/libvips-0.5.0-heroku.tgz](https://caliper-tests.s3.amazonaws.com/bundles/libvips-0.5.0-heroku.tgz)

The bundles are generated by CI and versions match the most updated tag.

## Usage

Point the `BUILDPACK_URL` config to or add the following to your `.buildpacks`
when using
[Heroku Buildpack Multi](https://github.com/heroku/heroku-buildpack-multi).

```
https://github.com/the-grid/heroku-buildpack-vips.git
```

## Build script

[This](./build.sh) is the script used to build vips on `heroku run bash`.
